<script lang="ts">
	import { SectionSubHeading, UserCard } from "$lib/components";
	import type { Project, User } from "$lib/graphql/generated/sdk";
	import { formatCurrency, formatPercent, pluralize } from "$lib/utils/format";
	import TaskCard from "./TaskCard.svelte";

    interface Props {
        project:Project
    }
    let { project }:Props = $props()

    let featurePriority = $state("high" as "high"|"med"|"low")
    let valuePriority = $state("med" as "high"|"med"|"low")
    let milestonePriority = $state("low" as "high"|"med"|"low")


</script>


<div class="grid grid-cols-3 gap-16">
    <div>
        <SectionSubHeading>{project.projectBasics.name}</SectionSubHeading>

        <h3 class="text-gray-100 font-semibold">Owner</h3>
        <UserCard user={project.projectBasics.owner as User} />

        <h3 class="text-gray-100 font-semibold mt-6">Executive Summary</h3>
        <p class="py-2 text-gray-200">{@html project.projectBasics.description.replaceAll(/[\n]/g, "<br />")}</p>
    </div>

    <div class="col-span-2">
        <SectionSubHeading>TODO: Fill out the Details of this Project</SectionSubHeading>

        <TaskCard task="Break your project value down into a list of features" link="#features" priority={featurePriority}>
            This project currently has <b>{project.projectFeatures?.length}</b> {pluralize("feature", project.projectFeatures?.length as number)}
        </TaskCard>

        <TaskCard task="Estimate and characterize the value generated by this project" link="#value" priority={valuePriority}>
            This project has a 5-year NPV of 
            <b>{formatCurrency.format(project.projectValue.calculated?.netPresentValue as number)} </b>
            with an IRR of 
            <b>{formatPercent.format(project.projectValue.calculated?.internalRateOfReturn as number)}</b>
        </TaskCard>

        <TaskCard task="Create tasks and assign resources" link="#value" priority={milestonePriority}>
            This project currently has <b>{project.projectMilestones?.length}</b> {pluralize("feature", project.projectMilestones?.length as number)}
        </TaskCard>

    </div>
</div>
